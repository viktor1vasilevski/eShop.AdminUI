<div class="card shadow-sm">
  <div
    class="card-header text-white d-flex justify-content-between align-items-center"
    style="background-color: #495057"
  >
    <!-- Header text + icon -->
    <span>
      <span *ngIf="settings().header.icon">
        <i [class]="settings().header.icon + ' me-2'"></i>
      </span>
      {{ settings().header.text }}
    </span>

    <!-- Optional header action button -->
    <button
      *ngIf="settings().header.actionButton"
      class="btn btn-light btn-sm"
      [routerLink]="settings().header.actionButton?.routerLink"
      (click)="settings().header.actionButton?.click?.()"
      [ngClass]="settings().header.actionButton?.class"
      type="button"
    >
      <i
        *ngIf="settings().header.actionButton?.icon"
        [class]="settings().header.actionButton?.icon + ' me-1'"
      ></i>
      {{ settings().header.actionButton?.text }}
    </button>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <colgroup>
          <col
            *ngFor="let col of settings().columns"
            [style.width]="col.width || 'auto'"
          />
        </colgroup>

        <thead class="table-dark">
          <tr>
            <th
              *ngFor="let col of settings().columns"
              [style.width]="col.width || 'auto'"
              [class.sortable]="col.sortable"
              [class.text-end]="col.field === 'actions'"
              [class.pe-3]="col.field === 'actions'"
              (click)="toggleSort(col)"
            >
              <span>{{ col.title }}</span>

              <!-- show sort icon only if column is sortable -->
              <ng-container *ngIf="col.sortable">
                <i
                  class="bi ms-1"
                  [ngClass]="[
                    sortBy() === (col.sortKey || col.field) &&
                    sortDirection() === SortOrderRef.Ascending
                      ? 'bi-arrow-up'
                      : sortBy() === (col.sortKey || col.field) &&
                        sortDirection() === SortOrderRef.Descending
                      ? 'bi-arrow-down'
                      : 'bi-arrow-down'
                  ]"
                ></i>
              </ng-container>
            </th>
          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let row of data()"
            [class.uncategorized]="row['name'] === 'UNCATEGORIZED'"
          >
            <td
              *ngFor="let col of settings().columns"
              [class.text-end]="col.field === 'actions'"
            >
              <!-- Actions column -->
              <ng-container *ngIf="col.field === 'actions'">
                <button
                  class="btn btn-sm btn-outline-secondary me-2"
                  (click)="row['view']?.()"
                  title="View details"
                  [disabled]="row['name'] === 'UNCATEGORIZED'"
                >
                  <i class="bi bi-eye"></i>
                </button>
                <button
                  class="btn btn-sm btn-outline-info me-2"
                  (click)="row['edit']?.()"
                  title="Edit"
                  [disabled]="row['name'] === 'UNCATEGORIZED'"
                >
                  <i class="bi bi-pencil"></i>
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  (click)="row['delete']?.()"
                  title="Delete"
                  [disabled]="row['name'] === 'UNCATEGORIZED'"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </ng-container>

              <span
                *ngIf="
                  col.field !== 'actions' && (!col.type || col.type === 'text')
                "
              >
                {{ row[col.field] || "/" }}
              </span>

              <span
                *ngIf="col.field !== 'actions' && col.type === 'html'"
                [innerHTML]="row[col.field] || '/'"
              ></span>

              <span *ngIf="col.field !== 'actions' && col.type === 'date'">
                {{
                  row[col.field]
                    ? (row[col.field] | date : "dd/MM/yyyy HH:mm")
                    : "/"
                }}
              </span>
            </td>
          </tr>

          <tr *ngIf="data().length === 0">
            <td
              [attr.colspan]="settings().columns.length"
              class="text-center text-muted"
            >
              No data found.
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <app-pagination
        *ngIf="settings().pagination?.enabled && data().length > 0"
        [currentPage]="currentPage()"
        [totalPages]="totalPages()"
        [itemsPerPage]="itemsPerPage()"
        [itemsPerPageOptions]="
          settings().pagination?.itemsPerPageOptions ?? [5, 10, 20]
        "
        (pageChange)="pageChange.emit($event)"
        (itemsPerPageChange)="itemsPerPageChange.emit($event)"
      ></app-pagination>
    </div>
  </div>
</div>
