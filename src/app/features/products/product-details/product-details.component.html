<div class="main-content p-4">
  <div class="row g-4">
    <div class="col-md-4">
      <div class="position-sticky" style="top: 1rem">
        <div class="card shadow-sm">
          <div
            class="card-header bg-secondary text-white d-flex justify-content-between align-items-center py-2"
          >
            <h5 class="mb-0 d-flex align-items-center">
              <i class="bi bi-box-seam me-2"></i>{{ product.name }}
            </h5>

            <div class="d-flex gap-2">
              <button
                class="btn btn-sm btn-light"
                [routerLink]="['/products/edit', product.id]"
              >
                <i class="bi bi-pencil-square me-1"></i>Edit
              </button>

              <button
                class="btn btn-sm btn-danger"
                (click)="showDeleteProductModal(product)"
              >
                <i class="bi bi-trash me-1"></i>Delete
              </button>
            </div>
          </div>

          <div class="card-body p-4">
            <div class="mb-3">
              <h6 class="text-muted mb-1">Quantity</h6>
              <p class="mb-0 fw-medium">{{ product.unitQuantity }}</p>
            </div>
            <div class="mb-3">
              <h6 class="text-muted mb-1">Price</h6>
              <p class="mb-0 fw-bold text-success">
                {{ product.unitPrice | currency }}
              </p>
            </div>

            <div class="mb-3">
              <h6 class="text-muted mb-1">Category Path</h6>
              <p class="mb-0 fw-medium">
                <ng-container
                  *ngFor="let cat of product.categories; let i = index"
                >
                  <a
                    [routerLink]="['/categories', cat.id]"
                    class="text-decoration-none"
                  >
                    {{ cat.name }}
                  </a>
                  <span *ngIf="i < product.categories.length - 1"> / </span>
                </ng-container>
              </p>
            </div>

            <div class="mb-3">
              <h6 class="text-muted mb-1">Created</h6>
              <p class="mb-0 fw-medium">
                {{ product.created | date : "medium" }}
              </p>
            </div>

            <div class="mb-3">
              <h6 class="text-muted mb-1">Last Modified</h6>
              <p class="mb-0 fw-medium">
                {{
                  product.lastModified
                    ? (product.lastModified | date : "medium")
                    : "—"
                }}
              </p>
            </div>

            <div class="text-center mb-4" *ngIf="product.image; else noImage">
              <img
                [src]="product.image"
                [alt]="product.name"
                class="img-fluid rounded shadow-sm"
                style="max-height: 250px; object-fit: contain"
              />
            </div>
            <ng-template #noImage>
              <div class="text-center text-muted fst-italic mb-4">
                <i class="bi bi-image me-1"></i>No image available
              </div>
            </ng-template>

            <div class="mb-4">
              <h6 class="text-muted mb-1">Description</h6>
              <p class="mb-0">{{ product.description || "—" }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-header bg-body text-body">
          <h6 class="mb-0 d-flex align-items-center">
            <i class="bi bi-chat-dots me-2"></i>
            Comments
            <span class="text-muted ms-2"
              >({{ product.comments?.length || 0 }})</span
            >
          </h6>
        </div>
        <div class="card-body">
          <ng-container *ngIf="product.comments?.length; else noComments">
            <div
              *ngFor="let c of product.comments"
              class="border-bottom py-2 mb-2"
              [ngClass]="{
                'pb-3 mb-3': c !== product.comments[product.comments.length - 1]
              }"
            >
              <div
                class="d-flex justify-content-between align-items-center mb-1"
              >
                <div class="d-flex align-items-center">
                  <div class="comment-avatar me-2">
                    {{ c.username[0] | uppercase }}
                  </div>
                  <strong>{{ c.username }}</strong>
                </div>
                <small class="text-muted">{{
                  c.created | date : "short"
                }}</small>
              </div>

              <div class="text-muted small mb-1">
                <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                  <i
                    class="bi"
                    [ngClass]="
                      star <= c.rating
                        ? 'bi-star-fill text-warning'
                        : 'bi-star text-muted'
                    "
                  ></i>
                </ng-container>
                {{ c.rating }}/5
              </div>

              <p class="mb-0">{{ c.commentText }}</p>
            </div>
          </ng-container>

          <ng-template #noComments>
            <div class="text-muted fst-italic text-center py-3">
              No comments yet.
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
  <div
    class="modal fade"
    id="deleteConfirmationModal"
    tabindex="-1"
    aria-labelledby="deleteConfirmationModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteConfirmationModalLabel">
            Confirm Delete
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete
            <strong>{{ productToDelete?.name }}</strong
            >?
          </p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-danger"
            (click)="deleteProduct()"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
