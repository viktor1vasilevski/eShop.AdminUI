<div class="p-3 mb-3 bg-light rounded shadow-sm border">
  <!-- header -->
  <div class="d-flex justify-content-between align-items-center mb-1">
    <div class="d-flex align-items-center">
      <i class="bi bi-diagram-3 me-2 text-secondary"></i>
      <span class="fw-semibold">{{ subcategory()?.name }}</span>
      <span
        class="badge text-bg-secondary ms-2"
        *ngIf="(subcategory()?.products?.length || 0) > 0"
      >
        {{ subcategory()?.products?.length }} product{{
          (subcategory()?.products?.length || 0) === 1 ? "" : "s"
        }}
      </span>
    </div>

    <button
      class="btn btn-sm btn-outline-primary d-inline-flex align-items-center"
      (click)="editSubcategory.emit(subcategory())"
    >
      <i class="bi bi-pencil me-1"></i> Edit
    </button>
  </div>

  <hr class="my-3 border-top border-2 border-secondary-subtle" />

  <!-- per-subcategory search -->
  <app-filter-input
    label="Products"
    placeholder="Search in this subcategoryâ€¦"
    [value]="subSearch()"
    (valueChanged)="subSearch.set($event)"
    [disabled]="!!globalSearch()"
    autocomplete="off"
  >
  </app-filter-input>

  <!-- products -->
  <ng-container *ngIf="filteredProducts().length; else noProducts">
    <div class="mt-2">
      <ul class="list-inline mb-0">
        <li class="list-inline-item mb-1" *ngFor="let p of visibleProducts()">
          <span
            class="badge text-bg-warning d-inline-flex align-items-center border border-dark"
          >
            {{ p.name }}

            <!-- view -->
            <a
              class="ms-2 text-decoration-none"
              [routerLink]="['/products', p.id]"
              title="View product"
            >
              <i class="bi bi-box-arrow-up-right"></i>
            </a>

            <!-- edit -->
            <a
              class="ms-2 text-decoration-none text-primary"
              [routerLink]="['/products', p.id, 'edit']"
              title="Edit product"
            >
              <i class="bi bi-pencil"></i>
            </a>

            <!-- delete -->
            <a
              class="ms-2 text-decoration-none text-danger"
              href="javascript:void(0)"
              (click)="deleteProduct.emit(p)"
              title="Delete product"
            >
              <i class="bi bi-trash"></i>
            </a>
          </span>
        </li>
      </ul>

      <!-- show more / less -->
      <div *ngIf="filteredProducts().length > pageSize()" class="mt-2">
        <button
          class="btn btn-sm btn-secondary d-inline-flex align-items-center"
          (click)="expanded.set(!expanded())"
        >
          <i
            class="bi me-1"
            [ngClass]="expanded() ? 'bi-chevron-up' : 'bi-chevron-down'"
          ></i>
          {{ expanded() ? "Show less" : "Show more" }}
        </button>
        <span class="badge text-bg-info ms-2">
          {{ visibleCount() }} of {{ filteredProducts().length }}
        </span>
      </div>
    </div>
  </ng-container>

  <ng-template #noProducts>
    <div class="text-muted fst-italic small mt-1">No products.</div>
  </ng-template>
</div>
